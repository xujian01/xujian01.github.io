<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>è¿™ä¹ˆå¼ºå¤§çš„Mybatisæ’ä»¶æœºåˆ¶åŸæ¥å°±æ˜¯è¿™ï¼Ÿ | å¢¨é±¼ğŸ¦‘çš„ä¸ªäººåšå®¢</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">è¿™ä¹ˆå¼ºå¤§çš„Mybatisæ’ä»¶æœºåˆ¶åŸæ¥å°±æ˜¯è¿™ï¼Ÿ</h1><a id="logo" href="/.">å¢¨é±¼ğŸ¦‘çš„ä¸ªäººåšå®¢</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">è¿™ä¹ˆå¼ºå¤§çš„Mybatisæ’ä»¶æœºåˆ¶åŸæ¥å°±æ˜¯è¿™ï¼Ÿ</h1><div class="post-meta">2021-05-13</div><div class="post-content"><p>Mybatiså¼€å‘ä¸­ç»å¸¸ä¼šç”¨åˆ°pagehelperåˆ†é¡µæ’ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰æ…¢sqlä¸ŠæŠ¥ç­‰å„ç§å„æ ·çš„æ’ä»¶ï¼Œé‚£ä¹ˆMybatisæ˜¯å¦‚ä½•æ¥å®ç°å¦‚æ­¤å¼ºå¤§çš„æ’ä»¶æœºåˆ¶å‘¢ï¼Ÿä¸€èµ·æ¥çœ‹çœ‹å§ã€‚</p>
<span id="more"></span>
<h2 id="Mybatisæ’ä»¶æœºåˆ¶ä»‹ç»"><a href="#Mybatisæ’ä»¶æœºåˆ¶ä»‹ç»" class="headerlink" title="Mybatisæ’ä»¶æœºåˆ¶ä»‹ç»"></a>Mybatisæ’ä»¶æœºåˆ¶ä»‹ç»</h2><p>MyBatis å…è®¸ä½ åœ¨æ˜ å°„è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸä¸€ç‚¹è¿›è¡Œæ‹¦æˆªè°ƒç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMyBatis å…è®¸ä½¿ç”¨æ’ä»¶æ¥æ‹¦æˆªçš„æ–¹æ³•è°ƒç”¨åŒ…æ‹¬ï¼š</p>
<ul>
<li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li>
</ul>
<p>æ‰§è¡Œå™¨ï¼Œæä¾›æ“ä½œæ•°æ®åº“çš„æ¥å£ã€‚</p>
<ul>
<li>ParameterHandler (getParameterObject, setParameters)</li>
</ul>
<p>å‚æ•°å¤„ç†å™¨ï¼Œè®¾ç½®sqlçš„å‚æ•°ã€‚</p>
<ul>
<li>ResultSetHandler (handleResultSets, handleOutputParameters)</li>
</ul>
<p>ç»“æœé›†å¤„ç†å™¨ï¼Œå¤„ç†ä»æ•°æ®åº“æŸ¥è¯¢çš„ç»“æœé›†ï¼Œå°è£…æˆå¯¹è±¡ç­‰ã€‚</p>
<ul>
<li>StatementHandler (prepare, parameterize, batch, update, query)</li>
</ul>
<p>è¯­æ³•å¤„ç†å™¨ï¼ŒçœŸæ­£å»æ‰§è¡Œæ•°æ®åº“CRUDã€‚</p>
<p>ä»–ä»¬çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹<br><img src="https://img-blog.csdnimg.cn/20210518153023684.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE4NTE1MTU1,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯è§å…¶æ’ä»¶æ˜¯åŸºäº<strong>æ–¹æ³•æ‹¦æˆª</strong>æ¥å®ç°çš„ï¼æˆ‘ä»¬å§‘ä¸”çŒœæµ‹æ˜¯å’ŒAOPæœ‰å…³ï¼Œåˆ°åº•å¯¹ä¸å¯¹å‘¢ï¼Œå¾€ä¸‹çœ‹å°±çŸ¥é“äº†ã€‚</p>
<h2 id="è‡ªå®šä¹‰ä¸€ä¸ªMybatisæ’ä»¶"><a href="#è‡ªå®šä¹‰ä¸€ä¸ªMybatisæ’ä»¶" class="headerlink" title="è‡ªå®šä¹‰ä¸€ä¸ªMybatisæ’ä»¶"></a>è‡ªå®šä¹‰ä¸€ä¸ªMybatisæ’ä»¶</h2><p>è‡ªå®šä¹‰ä¸€ä¸ªæ’ä»¶æ˜¯å¦‚æ­¤ç®€å•ï¼Œä»¥æ‹¦æˆª<code>ResultSetHandler</code>ä¸ºä¾‹ï¼Œä»…éœ€è¦ä¸¤æ­¥ï¼ˆMybatisç‰ˆæœ¬ï¼š3.5.6ï¼‰ï¼š</p>
<p>æ­¥éª¤ä¸€ï¼šå®ç°Interceptoræ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mybatisplugin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.resultset.ResultSetHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Intercepts;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Invocation;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Signature;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xujian</span></span><br><span class="line"><span class="comment"> * 2021-05-11 15:22</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Intercepts(@Signature(type = ResultSetHandler.class,//æŒ‡å®šä½ è¦æ‹¦æˆªæ˜¯å“ªä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="meta">        method = &quot;handleResultSets&quot;,//æŒ‡å®šä½ è¦æ‹¦æˆªçš„æ˜¯å“ªä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="meta">        args = &#123;Statement.class&#125;))</span><span class="comment">//è€ƒè™‘åˆ°æ–¹æ³•é‡è½½ï¼Œè¿˜éœ€è¦æŒ‡å®šå‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPlugin</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        log.info(<span class="string">&quot;----æ’ä»¶æ‹¦æˆªåˆ°handleResultSets----&quot;</span>);</span><br><span class="line">        <span class="comment">//å®è¡ŒåŸå§‹çš„æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¥éª¤äºŒï¼šåœ¨Mybatisçš„é…ç½®æ–‡ä»¶åŠ å…¥è‡ªå®šä¹‰æ’ä»¶çš„é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;mybatisplugin.MyPlugin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œå½“æ‰§è¡Œäº†æ•°æ®åº“æŸ¥è¯¢æ“ä½œï¼Œè°ƒç”¨<code>ResultSetHandler#handleResultSets</code>å°è£…è¿”å›ç»“æœé›†ä¹‹å‰ä¼šæ‰“å°æ—¥å¿—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="https://img-blog.csdnimg.cn/20210518153234753.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE4NTE1MTU1,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="æ’ä»¶æ‰§è¡ŒåŸç†åˆ†æ"><a href="#æ’ä»¶æ‰§è¡ŒåŸç†åˆ†æ" class="headerlink" title="æ’ä»¶æ‰§è¡ŒåŸç†åˆ†æ"></a>æ’ä»¶æ‰§è¡ŒåŸç†åˆ†æ</h2><h3 id="æ’ä»¶å®šä¹‰"><a href="#æ’ä»¶å®šä¹‰" class="headerlink" title="æ’ä»¶å®šä¹‰"></a>æ’ä»¶å®šä¹‰</h3><p>å®ç°<code>Interceptor</code>ï¼Œå…¶æºç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹¦æˆªå™¨æ¥å£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Clinton Begin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‹¦æˆªæ–¹æ³•ï¼Œè‡ªå®šä¹‰æ’ä»¶éœ€è¦å®ç°çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> invocation è°ƒç”¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è°ƒç”¨ç»“æœ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable è‹¥å‘ç”Ÿå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åº”ç”¨æ’ä»¶ã€‚å¦‚åº”ç”¨æˆåŠŸï¼Œåˆ™ä¼šåˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target ç›®æ ‡å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åº”ç”¨çš„ç»“æœå¯¹è±¡ï¼Œå¯ä»¥æ˜¯ä»£ç†å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ target å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»»æ„å¯¹è±¡ã€‚å…·ä½“çš„ï¼Œçœ‹ä»£ç å®ç°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">default</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> 		<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®æ’ä»¶å±æ€§</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;plugin&gt;æ ‡ç­¾çš„properties å±æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ’ä»¶æ˜¯å®šä¹‰å¥½äº†ï¼Œé‚£æ’ä»¶æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ç”Ÿæ•ˆçš„å‘¢ï¼Ÿ</p>
<h3 id="æ’ä»¶åˆå§‹åŒ–"><a href="#æ’ä»¶åˆå§‹åŒ–" class="headerlink" title="æ’ä»¶åˆå§‹åŒ–"></a>æ’ä»¶åˆå§‹åŒ–</h3><p>å½“åœ¨é…ç½®æ–‡ä»¶é…ç½®ä¸Šè‡ªå®šä¹‰æ’ä»¶ä»¥åï¼Œmybatisåœ¨åˆå§‹åŒ–è§£æé…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šè§£æ<plugin>æ ‡ç­¾ã€‚</p>
<p><code>XMLConfigBuilder#parseConfiguration</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseConfiguration</span><span class="params">(XNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="comment">// è§£æ &lt;plugins /&gt; æ ‡ç­¾</span></span><br><span class="line">            pluginElement(root.evalNode(<span class="string">&quot;plugins&quot;</span>));</span><br><span class="line">            ...</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BuilderException</span>(<span class="string">&quot;Error parsing SQL Mapper Configuration. Cause: &quot;</span> + e, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>å»åˆ°çœŸæ­£è§£æ<plugin>æ ‡ç­¾çš„æ–¹æ³•<code>XMLConfigBuilder#pluginElement</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pluginElement</span><span class="params">(XNode parent)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// éå† &lt;plugins /&gt; æ ‡ç­¾</span></span><br><span class="line">            <span class="keyword">for</span> (XNode child : parent.getChildren()) &#123;</span><br><span class="line">              	<span class="comment">//ä»xmlçš„interceptorå±æ€§ä¸­è§£æå‡ºæ’ä»¶çš„åç§°ï¼ˆåŒ…å+ç±»åå³å…¨é™å®šåï¼‰</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">interceptor</span> <span class="operator">=</span> child.getStringAttribute(<span class="string">&quot;interceptor&quot;</span>);</span><br><span class="line">              	<span class="comment">//1ã€ä»xmlé…ç½®æ–‡ä»¶è§£æå‡ºæ¥æ’ä»¶çš„é…ç½®</span></span><br><span class="line">                <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> child.getChildrenAsProperties();</span><br><span class="line">                <span class="comment">//2ã€åˆ›å»º Interceptor å¯¹è±¡ï¼Œå¹¶è®¾ç½®å±æ€§</span></span><br><span class="line">                <span class="type">Interceptor</span> <span class="variable">interceptorInstance</span> <span class="operator">=</span> (Interceptor) resolveClass(interceptor).newInstance();</span><br><span class="line">              	<span class="comment">//3ã€ç»™æ’ä»¶å¯¹è±¡è®¾ç½®ä¸Šæ’ä»¶é…ç½®çš„å±æ€§</span></span><br><span class="line">                interceptorInstance.setProperties(properties);</span><br><span class="line">                <span class="comment">//4ã€æ·»åŠ åˆ° configuration ä¸­</span></span><br><span class="line">                configuration.addInterceptor(interceptorInstance);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ°ä¸Šé¢çš„ç¬¬2æ­¥ï¼Œè¯¥æ­¥éª¤æ˜¯é€šè¿‡åå°„åˆ›å»ºå‡ºæ’ä»¶å¯¹è±¡çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯MyPluginå¯¹è±¡ã€‚</p>
<p>è·Ÿè¸ª<code>resolveClass</code>æ–¹æ³•ï¼Œæœ€åå‘ç°å®é™…ä¸Šæ˜¯è°ƒç”¨çš„<code>TypeAliasRegistry#resolveAlias</code></p>
<p>å…·ä½“æ¥çœ‹ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*å‚æ•°æ˜¯æ’ä»¶çš„å…¨é™å®šå</span></span><br><span class="line"><span class="comment">è¿”å›æ’ä»¶çš„Classå¯¹è±¡</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; Class&lt;T&gt; <span class="title function_">resolveAlias</span><span class="params">(String string)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (string == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// issue #748</span></span><br><span class="line">            <span class="comment">// è½¬æ¢æˆå°å†™</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> string.toLowerCase(Locale.ENGLISH);</span><br><span class="line">            Class&lt;T&gt; value;</span><br><span class="line">            <span class="keyword">if</span> (TYPE_ALIASES.containsKey(key)) &#123;</span><br><span class="line">            <span class="comment">//é¦–å…ˆï¼Œä» TYPE_ALIASESï¼ˆåˆ«åæ³¨å†Œè¡¨ï¼‰ ä¸­è·å–ï¼Œå¦‚æœé…ç½®äº†åˆ«åï¼Œ</span></span><br><span class="line">          	<span class="comment">//é‚£ä¹ˆé…ç½®æ’ä»¶çš„æ—¶å€™å°±ä¸éœ€è¦é…ç½®å…¨é™å®šåï¼Œåªéœ€è¦é…ç½®ç±»åå³å¯ï¼Œ</span></span><br><span class="line">          	<span class="comment">//é‚£ä¹ˆå°±ä¼šèµ°åˆ°è¯¥åˆ†æ”¯</span></span><br><span class="line">                value = (Class&lt;T&gt;) TYPE_ALIASES.get(key);</span><br><span class="line">            <span class="comment">// å…¶æ¬¡ï¼Œç›´æ¥è·å¾—å¯¹åº”ç±»</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                value = (Class&lt;T&gt;) Resources.classForName(string);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123; <span class="comment">// å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeException</span>(<span class="string">&quot;Could not resolve type alias &#x27;&quot;</span> + string + <span class="string">&quot;&#x27;.  Cause: &quot;</span> + e, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡ä¸Šè¿°è¿‡ç¨‹å°±æ‹¿åˆ°äº†æ’ä»¶çš„å®ä¾‹å¯¹è±¡ï¼Œç„¶åèµ°åˆ°æ­¥éª¤4ï¼Œè¯¥æ­¥éª¤æ˜¯å°†æ’ä»¶è®¾ç½®åˆ°å…¨å±€é…ç½®ç±»<code>Configuration</code>ä¸­ã€‚</p>
<p>è·Ÿè¸ª<code>addInterceptor</code>æ–¹æ³•ï¼Œå‘ç°å…¶æœ€ç»ˆè°ƒç”¨çš„æ˜¯<code>InterceptorChain#addInterceptor</code>ï¼Œè€Œ<code>Configuration</code>ä¸­å°±æŒæœ‰<code>InterceptorChain</code>çš„å¼•ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹¦æˆªå™¨é“¾</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Clinton Begin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterceptorChain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‹¦æˆªå™¨æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Interceptor&gt; interceptors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åº”ç”¨æ‰€æœ‰æ’ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target ç›®æ ‡å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åº”ç”¨ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">pluginAll</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Interceptor interceptor : interceptors) &#123;</span><br><span class="line">            target = interceptor.plugin(target);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptor</span><span class="params">(Interceptor interceptor)</span> &#123;</span><br><span class="line">        interceptors.add(interceptor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Interceptor&gt; <span class="title function_">getInterceptors</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableList(interceptors);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InterceptorChain</code>å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª<code>Interceptor</code>åˆ—è¡¨ï¼Œç”¨æ¥å­˜æ”¾æ‰€æœ‰è‡ªå®šä¹‰çš„æ’ä»¶ã€‚</p>
<h3 id="æ’ä»¶å¦‚ä½•ç”Ÿæ•ˆ"><a href="#æ’ä»¶å¦‚ä½•ç”Ÿæ•ˆ" class="headerlink" title="æ’ä»¶å¦‚ä½•ç”Ÿæ•ˆ"></a>æ’ä»¶å¦‚ä½•ç”Ÿæ•ˆ</h3><p>æ³¨æ„åˆ°ä¸Šé¢è‡ªå®šä¹‰çš„æ’ä»¶ç±»ä¸Šæœ‰å¦‚ä¸‹æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(@Signature(type = ResultSetHandler.class,//æŒ‡å®šä½ è¦æ‹¦æˆªæ˜¯å“ªä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="meta">        method = &quot;handleResultSets&quot;,//æŒ‡å®šä½ è¦æ‹¦æˆªçš„æ˜¯å“ªä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="meta">        args = &#123;Statement.class&#125;))</span><span class="comment">//è€ƒè™‘åˆ°æ–¹æ³•é‡è½½ï¼Œè¿˜éœ€è¦æŒ‡å®šå‚æ•°åˆ—è¡¨</span></span><br></pre></td></tr></table></figure>

<p>è¯¥æ³¨è§£å£°æ˜äº†è¯¥æ’ä»¶ç”Ÿæ•ˆçš„æ—¶æœºï¼šmybatisåœ¨è°ƒç”¨<code>ResultSetHandler#handleResultSets(Statement stmt)</code>æ–¹æ³•æ—¶ä¼šæ‰§è¡Œæ’ä»¶é€»è¾‘ã€‚</p>
<p>å®é™…ä¸Š<code>ResultSetHandler</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒçš„é»˜è®¤å®ç°ç±»æ˜¯<code>DefaultResultSetHandler</code>ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œmybatisæœ€ç»ˆæ˜¯é€šè¿‡<code>ResultSetHandler</code>æ¥å¤„ç†ä»æ•°æ®åº“æŸ¥è¯¢çš„ç»“æœçš„ï¼Œ</p>
<p>é‚£å°±æ¥æ‰¾åˆ°åˆ›å»º<code>ResultSetHandler</code>çš„åœ°æ–¹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º ResultSetHandler å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> ResultSetHandler <span class="title function_">newResultSetHandler</span><span class="params">(Executor executor, MappedStatement mappedStatement, RowBounds rowBounds, ParameterHandler parameterHandler,</span></span><br><span class="line"><span class="params">                                                ResultHandler resultHandler, BoundSql boundSql)</span> &#123;</span><br><span class="line">        <span class="comment">// 1ã€åˆ›å»º DefaultResultSetHandler å¯¹è±¡</span></span><br><span class="line">        <span class="type">ResultSetHandler</span> <span class="variable">resultSetHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultResultSetHandler</span>(executor, mappedStatement, parameterHandler, resultHandler, boundSql, rowBounds);</span><br><span class="line">        <span class="comment">// 2ã€åº”ç”¨æ’ä»¶</span></span><br><span class="line">        resultSetHandler = (ResultSetHandler) interceptorChain.pluginAll(resultSetHandler);</span><br><span class="line">        <span class="keyword">return</span> resultSetHandler;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹å…³æ³¨æ­¥éª¤2ï¼Œåœ¨æ­¥éª¤1åˆ›å»ºäº†ä¸€ä¸ª<code>DefaultResultSetHandler</code>åˆ›å»ºäº†ä¸€ä¸ªé»˜è®¤çš„<code>ResultSetHandler</code>å®ç°ä»¥åï¼Œè°ƒç”¨äº†<code>InterceptorChain#pluginAll</code>æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¸ªè¯¥æ–¹æ³•ï¼Œæœ€ç»ˆå‘ç°æ˜¯éå†<code>InterceptorChain</code>ä¿å­˜çš„æ‰€æœ‰çš„æ’ä»¶ï¼Œç„¶åé€ä¸ªè°ƒç”¨æ’ä»¶çš„<code>plugin</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åº”ç”¨æ‰€æœ‰æ’ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target ç›®æ ‡å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åº”ç”¨ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">pluginAll</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Interceptor interceptor : interceptors) &#123;</span><br><span class="line">            target = interceptor.plugin(target);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ç´§æ¥ç€å†æ¥çœ‹çœ‹<code>Interceptor#plugin</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å†…éƒ¨è°ƒç”¨äº†<code>Plugin</code>ç±»çš„é™æ€<code>wrap</code>æ–¹æ³•</p>
<p>é«˜èƒ½æ¥äº†ï¼é«˜èƒ½æ¥äº†ï¼é«˜èƒ½æ¥äº†ï¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target ç›®æ ‡ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> interceptor æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">wrap</span><span class="params">(Object target, Interceptor interceptor)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å¾—æ‹¦æˆªçš„æ–¹æ³•æ˜ å°„ï¼Œå“ªä¸ªç±»çš„å“ªäº›æ–¹æ³•éœ€è¦è¢«æ‹¦æˆª</span></span><br><span class="line">        Map&lt;Class&lt;?&gt;, Set&lt;Method&gt;&gt; signatureMap = getSignatureMap(interceptor);</span><br><span class="line">        <span class="comment">// è·å¾—ç›®æ ‡ç±»çš„ç±»å‹</span></span><br><span class="line">        Class&lt;?&gt; type = target.getClass();</span><br><span class="line">        <span class="comment">// è·å¾—ç›®æ ‡ç±»çš„æ¥å£é›†åˆ</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = getAllInterfaces(type, signatureMap);</span><br><span class="line">        <span class="comment">// è‹¥æœ‰æ¥å£ï¼Œåˆ™åˆ›å»ºç›®æ ‡å¯¹è±¡çš„ JDK Proxy å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> (interfaces.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Proxy.newProxyInstance(</span><br><span class="line">                    type.getClassLoader(),</span><br><span class="line">                    interfaces,</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Plugin</span>(target, interceptor, signatureMap)); <span class="comment">// å› ä¸º Plugin å®ç°äº† InvocationHandler æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸º JDK åŠ¨æ€ä»£ç†çš„è°ƒç”¨å¤„ç†å™¨</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›åŸå§‹çš„ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>Proxy.newProxyInstance(type.getClassLoader(),interfaces,new Plugin(target, interceptor, signatureMap));</code></p>
<p>è¿™è¡Œä»£ç éš¾é“ä½ ä¸ç†Ÿæ‚‰å—ï¼Œæ²¡é”™ï¼Œè¿™æ­£æ˜¯<strong>JDKåŠ¨æ€ä»£ç†</strong>çš„å†™æ³•ã€‚</p>
<blockquote>
<p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥mybatisåˆ›å»ºçš„ResultSetHandlerå¯¹è±¡å…¶å®æ˜¯ç»è¿‡å±‚å±‚ä»£ç†è¿‡çš„å¯¹è±¡ã€‚</p>
</blockquote>
<p>é‚£æ—¢ç„¶æ˜¯JDKåŠ¨æ€ä»£ç†ï¼Œé‚£å°±åº”è¯¥æœ‰å¯¹<code>InvocationHandler</code>çš„å®ç°ï¼Œæ˜¯è°å‘¢ï¼Ÿ</p>
<p>çœ‹çœ‹<code>Plugin</code>è¿™ä¸ªç±»çš„å®šä¹‰<code>public class Plugin implements InvocationHandler</code>ä¼šå‘ç°å°±æ˜¯å®ƒäº†ã€‚</p>
<p>ç´§æ¥ç€æ¥çœ‹çœ‹<code>InvocationHandler</code>æœ€é‡è¦çš„<code>invoke</code>æ–¹æ³•çš„å®ç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å½“å‰æ–¹æ³•æ‰€å±çš„ç±»æœ‰å“ªäº›éœ€è¦è¢«æ‹¦æˆªçš„æ–¹æ³•</span></span><br><span class="line">            Set&lt;Method&gt; methods = signatureMap.get(method.getDeclaringClass());</span><br><span class="line">            <span class="keyword">if</span> (methods != <span class="literal">null</span> &amp;&amp; methods.contains(method)) &#123;</span><br><span class="line">                <span class="comment">// 1ã€å¦‚æœå½“å‰æ–¹æ³•åŒ…å«åœ¨è¦è¢«æ‹¦æˆªçš„æ–¹æ³•ä¹‹å†…ï¼Œåˆ™æ‹¦æˆªå¤„ç†è¯¥æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">return</span> interceptor.intercept(<span class="keyword">new</span> <span class="title class_">Invocation</span>(target, method, args));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 2ã€å¦‚æœä¸æ˜¯ï¼Œåˆ™è°ƒç”¨åŸæ–¹æ³•</span></span><br><span class="line">            <span class="keyword">return</span> method.invoke(target, args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> ExceptionUtil.unwrapThrowable(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>å¦‚æœå½“å‰æ–¹æ³•è¦è¢«æ‹¦æˆªï¼Œé‚£å°±è°ƒç”¨æ’ä»¶çš„<code>intercept</code>æ–¹æ³•ï¼›</li>
<li>å¦‚æœå½“å‰æ–¹æ³•ä¸éœ€è¦è¢«æ‹¦æˆªï¼Œé‚£å°±ç›´æ¥è°ƒç”¨åŸå§‹å¯¹è±¡çš„å¯¹åº”æ–¹æ³•ï¼›</li>
</ol>
<p>çœ‹åˆ°è¿™é‡Œå°±è±ç„¶å¼€æœ—äº†ï¼ŒåŸæ¥è‡ªå®šä¹‰æ’ä»¶æ—¶å®ç°çš„<code>intercept</code>æ–¹æ³•æ˜¯åœ¨è¿™é‡Œè¢«è°ƒç”¨äº†ã€‚</p>
<h2 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h2><p>ç°åœ¨æ¥æ•´ç†ä¸€ä¸‹æ€è·¯ï¼š</p>
<p>1ã€å°†è‡ªå®šä¹‰æ’ä»¶ä¿å­˜åˆ°<strong>æ’ä»¶é“¾</strong>ä¸­ï¼›<br><img src="https://img-blog.csdnimg.cn/20210518153059983.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE4NTE1MTU1,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>2ã€ä½¿ç”¨æ’ä»¶é“¾ä¸­çš„æ’ä»¶å±‚å±‚ä»£ç†<code>ResultSetHandler</code>ï¼›<br><img src="https://img-blog.csdnimg.cn/20210518153124699.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE4NTE1MTU1,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>3ã€è°ƒç”¨æ’ä»¶çš„<code>intercept</code>æ–¹æ³•ï¼›<br><img src="https://img-blog.csdnimg.cn/20210609193640498.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE4NTE1MTU1,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œå‘ç°Mybatisçš„æ’ä»¶æœºåˆ¶ä¸»è¦è¿˜æ˜¯ä¾èµ–äºJDKåŠ¨æ€ä»£ç†ï¼Œæ›´æŠ½è±¡ä¸€ç‚¹è¯´æ˜¯ä¾èµ–äºAOPæ€æƒ³ï¼Œå…¶æ ¸å¿ƒå°±æ˜¯â€œæ‹¦æˆª+å¢å¼ºâ€ï¼Œé‚£å…¶å®é™¤äº†Mybatisçš„æ’ä»¶æœºåˆ¶ï¼ŒSkywalkingçš„æ’ä»¶æœºåˆ¶ä¹Ÿæ˜¯åŸºäºè¿™ç§æ€æƒ³å®ç°çš„ï¼Œå¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_18515155/article/details/114454166">Skywalkingå¦‚ä½•é€šè¿‡ä¿®æ”¹å­—èŠ‚ç è®©æ’ä»¶ç”Ÿæ•ˆ</a>ã€‚</p>
<p>å·¥ä½œä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•å€Ÿé‰´è¿™ç§æ€æƒ³æ¥æ‰©å±•æˆ‘ä»¬çš„ä¸šåŠ¡æœåŠ¡ã€‚</p>
<p>æœ€åè®©æˆ‘ä»¬ä¸€èµ·å–Šå‡ºï¼š<strong>åŠ¨æ€ä»£ç†ï¼Œyydsï¼</strong></p>
<hr>
<p>ç›¸å…³ä»£ç è¯·å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/xujian01/blogcode/tree/master/src/main/java/mybatisplugin">https://github.com/xujian01/blogcode/tree/master/src/main/java/mybatisplugin</a></p>
</div><div class="tags"><a href="/tags/Mybatis/"><i class="fa fa-tag"></i>Mybatis</a></div><div class="post-nav"><a class="pre" href="/2021/06/15/enhance-jdk-proxy-v1/">å®ç°ä¸€ä¸ªå¢å¼ºç‰ˆçš„JDKåŠ¨æ€ä»£ç†V1.0</a><a class="next" href="/2021/05/10/spring-circle-depence/">æ¢ç´¢Springå¾ªç¯ä¾èµ–çš„ç»†èŠ‚</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/Apollo/" style="font-size: 15px;">Apollo</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Canal/" style="font-size: 15px;">Canal</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Mybatis/" style="font-size: 15px;">Mybatis</a> <a href="/tags/RocketMQ/" style="font-size: 15px;">RocketMQ</a> <a href="/tags/Gson/" style="font-size: 15px;">Gson</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 15px;">å¤šçº¿ç¨‹</a> <a href="/tags/GitLab/" style="font-size: 15px;">GitLab</a> <a href="/tags/WebHook/" style="font-size: 15px;">WebHook</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/Swagger/" style="font-size: 15px;">Swagger</a> <a href="/tags/ServiceMesh/" style="font-size: 15px;">ServiceMesh</a> <a href="/tags/Skywalking/" style="font-size: 15px;">Skywalking</a> <a href="/tags/ES/" style="font-size: 15px;">ES</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/06/25/print-xyz/">ä½¿ç”¨ä¸‰ä¸ªçº¿ç¨‹ï¼ŒæŒ‰é¡ºåºæ‰“å°Xï¼ŒYï¼ŒZï¼Œè¿ç»­æ‰“å°10æ¬¡</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/19/enhance-jdk-proxy-v2/">å®ç°ä¸€ä¸ªå¢å¼ºç‰ˆçš„JDKåŠ¨æ€ä»£ç†V2.0</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/15/enhance-jdk-proxy-v1/">å®ç°ä¸€ä¸ªå¢å¼ºç‰ˆçš„JDKåŠ¨æ€ä»£ç†V1.0</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/13/mybatis-plugin/">è¿™ä¹ˆå¼ºå¤§çš„Mybatisæ’ä»¶æœºåˆ¶åŸæ¥å°±æ˜¯è¿™ï¼Ÿ</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/10/spring-circle-depence/">æ¢ç´¢Springå¾ªç¯ä¾èµ–çš„ç»†èŠ‚</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/12/skywalking-plugin-principle/">Skywalkingå¦‚ä½•é€šè¿‡ä¿®æ”¹å­—èŠ‚ç è®©æ’ä»¶ç”Ÿæ•ˆ</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/26/gson-serialize-fail/">Gsonåºåˆ—åŒ–LinkedHashMap.Entryå¤±è´¥çš„æ¢ç´¢</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/20/springboot-es-mongodb/">SpringBootä¸­ä½¿ç”¨ESå’ŒMongoDBå¸¸ç”¨API</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/20/java-complier-optimization/">åˆé•¿è§è¯†äº†ï¼JVMç¼–è¯‘ä¼˜åŒ–</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/15/swagger+yapi/">Swagger API Spec + Swagger Codegen + YAPIç®¡ç†æ¥å£æ–‡æ¡£</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://blog.csdn.net/qq_18515155" title="CSDN-å¾å°é™Œçš„åšå®¢" target="_blank">CSDN-å¾å°é™Œçš„åšå®¢</a><ul></ul><a href="https://www.zhihu.com/people/xu-jian-1-1" title="çŸ¥ä¹-å€”å¼ºçš„ç å†œ" target="_blank">çŸ¥ä¹-å€”å¼ºçš„ç å†œ</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2022 <a href="/." rel="nofollow">å¢¨é±¼ğŸ¦‘çš„ä¸ªäººåšå®¢.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="å¤åˆ¶æˆåŠŸ!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>