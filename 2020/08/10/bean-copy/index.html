<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Bean Copy也就这么点事了！ | 墨鱼🦑的个人博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Bean Copy也就这么点事了！</h1><a id="logo" href="/.">墨鱼🦑的个人博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Bean Copy也就这么点事了！</h1><div class="post-meta">2020-08-10</div><div class="post-content"><p>工作中经常需要用到对象的Copy，这篇文章系统对对象Copy做一个系统的总结。</p>
<span id="more"></span>
<h1 id="什么是深拷贝和浅拷贝"><a href="#什么是深拷贝和浅拷贝" class="headerlink" title="什么是深拷贝和浅拷贝"></a>什么是深拷贝和浅拷贝</h1><p>先来看一张图：<br><img src="https://img-blog.csdnimg.cn/2020122011033046.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE4NTE1MTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>我们都知道对象的引用分配在栈上，对象的内存分配在堆上。<br>如上图所示，对象objB是对象objA的一个拷贝，objB只是在栈上重新分配了一个引用，但是实际指向的内存和objA是同一个，这就是<strong>浅拷贝</strong>；相反，如果objB除了在栈上分配了新的引用，并且在堆上也分配了新的内存空间，这就是<strong>深拷贝</strong>。</p>
<blockquote>
<p>浅拷贝就是复制对象的引用，修改复制的对象会影响原来的对象；深拷贝就是新建一个和原对象“一模一样”的对象，但是他们在堆上占用不同的内存。</p>
</blockquote>
<p><em>题外话：和深拷贝（Deep Copy）、浅拷贝（Shallow Copy），有相似概念的还有深堆（Deep Heap）、浅堆（Shallow Heap），感兴趣的同学可以自己查找资料。</em></p>
<h2 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h2><p><img src="https://img-blog.csdnimg.cn/20201220140829162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE4NTE1MTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol>
<li>对于数据类型是<strong>基本数据类型</strong>的成员变量，浅拷贝会直接将该属性值复制一份给新的对象。因为是两份不同的数据，所以对其中一个对象的该成员变量值进行修改，不会影响另一个对象拷贝得到的数据。</li>
<li>对于数据类型是<strong>引用数据类型</strong>的成员变量，比如说成员变量是某个数组、某个类的对象等，那么浅拷贝会将该成员变量的引用值（内存地址）复制一份给新的对象。因为实际上两个对象的该成员变量都指向同一个实例。在这种情况下，在一个对象中修改该成员变量会影响到另一个对象的该成员变量值。</li>
<li>String类型非常特殊，首先，String类型<strong>属于引用数据类型</strong>，不属于基本数据类型，但是String类型的数据是存放在常量池中的，也就是无法修改的！也就是说，当修改String类型成员变量后，并不是修改了这个数据的值，而是把这个数据的<strong>引用指向了一个新的字符串常量</strong>。<h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><h4 id="使用拷贝构造方法"><a href="#使用拷贝构造方法" class="headerlink" title="使用拷贝构造方法"></a>使用拷贝构造方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span> <span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">Address</span> <span class="variable">addr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>(<span class="string">&quot;北京&quot;</span>)</span><br><span class="line">	<span class="type">User</span> <span class="variable">userA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">10</span>,addr);</span><br><span class="line">	System.out.println(userA.getAge());</span><br><span class="line">	<span class="comment">//浅拷贝</span></span><br><span class="line">	<span class="type">User</span> <span class="variable">userC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(userA);</span><br><span class="line">	userC.setAge(<span class="number">30</span>);</span><br><span class="line">	System.out.println(userA.getAge());</span><br><span class="line">	System.out.println(userC.getAge());</span><br><span class="line">	System.out.println(userA.getAddr() == userCopy.getAddr());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> Address addr;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> age,Address addr)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.age = age;</span><br><span class="line">		<span class="built_in">this</span>.addr = addr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//复制构造方法，模拟浅拷贝</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">User</span><span class="params">(User source)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = source.age;</span><br><span class="line">        <span class="built_in">this</span>.addr = source.addr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> String addr;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Address</span><span class="params">(String addr)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.addr = addr;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
输出结果：</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">10</span><br><span class="line">20</span><br><span class="line">false</span><br></pre></td></tr></table></figure>
<h4 id="使用Cloneable"><a href="#使用Cloneable" class="headerlink" title="使用Cloneable"></a>使用Cloneable</h4><ol>
<li>实现<code>Cloneable</code>接口；</li>
<li>重写Object类的<code>clone()</code>方法；</li>
</ol>
<p><code>Address.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xujian</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-12-20 14:52</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String addr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Address</span><span class="params">(String addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddr</span><span class="params">(String addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Address&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;addr=&#x27;&quot;</span> + addr + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>User.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xujian</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-12-20 14:52</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Address addr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> age, Address addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Address <span class="title function_">getAddr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddr</span><span class="params">(Address addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, addr=&quot;</span> + addr +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xujian</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-12-20 15:08</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Address</span> <span class="variable">addr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>(<span class="string">&quot;北京市&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">userA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">10</span>,addr);</span><br><span class="line">        <span class="type">User</span> <span class="variable">userCopy</span> <span class="operator">=</span> (User) userA.clone();</span><br><span class="line">        System.out.println(userA);</span><br><span class="line">        System.out.println(userCopy);</span><br><span class="line">        <span class="comment">//判断userA和userCopy是否是同一个对象</span></span><br><span class="line">        System.out.println(userA == userCopy);</span><br><span class="line">        userCopy.setAge(<span class="number">20</span>);</span><br><span class="line">        addr.setAddr(<span class="string">&quot;西安市&quot;</span>);</span><br><span class="line">        System.out.println(userA);</span><br><span class="line">        System.out.println(userCopy);</span><br><span class="line">        <span class="comment">//判断userA的成员变量addr和userCopy的成员变量addr是否是同一个对象</span></span><br><span class="line">        System.out.println(userA.getAddr() == userCopy.getAddr());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">10</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;北京市&#x27;</span>&#125;&#125;</span><br><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">10</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;北京市&#x27;</span>&#125;&#125;</span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">10</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;西安市&#x27;</span>&#125;&#125;</span><br><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">20</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;西安市&#x27;</span>&#125;&#125;</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ol>
<li>基本类型的成员变量原始对象和拷贝对象互不影响；</li>
<li>可以看到clone()方法拷贝的userCopy对象和原对象的<strong>内容是一样的</strong>。然而他们并<strong>不是同一个对象</strong>；</li>
<li>原始对象和拷贝的象他们的引用类型成员变量<code>Address::addr</code>是同一个对象;</li>
<li>Object::clone()本身是个浅拷贝实现;</li>
</ol>
<p>⚠️注意</p>
<ol>
<li>使用<code>clone()</code>方法时必须实现Cloneable接口，否则会报错<code>CloneNotSupportedException</code>，其实Cloneable接口没有定义任何方法，它和<code>Serializable</code>接口一样，都是起到一个标识作用;</li>
<li><code>clone()</code>是一个native方法，所以在浅拷贝上其效率还是很好的;</li>
<li><code>clone()</code>三原则：<br>① 对任何的对象x，都有x.clone() !&#x3D;x&#x2F;&#x2F;克隆对象与原对象不是同一个对象；<br>② 对任何的对象x，都有x.clone().getClass()&#x3D;&#x3D;x.getClass()&#x2F;&#x2F;克隆对象与原对象的类型一样；<br>③ 如果对象x的equals()方法定义恰当，那么x.clone().equals(x)应该成立；<h4 id="使用Setter方法"><a href="#使用Setter方法" class="headerlink" title="使用Setter方法"></a>使用Setter方法</h4>通过对象内部提供的<code>Setter</code>方法简单且直接的进行对象的拷贝：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title function_">copyBySetter</span><span class="params">(User source)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setAge(source.getAge());</span><br><span class="line">        user.setAddr(source.getAddr());</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h2><img src="https://img-blog.csdnimg.cn/2020122014085249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE4NTE1MTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>不仅要复制对象的所有基本数据类型的成员变量值，还要为所有引用数据类型的成员变量申请存储空间，并复制每个引用数据类型成员变量所引用的对象，一直<strong>递归</strong>下去直到没有引用类型的成员变量。也就是说，对象进行深拷贝要对整个对象图进行拷贝；</li>
<li>深拷贝对引用数据类型的成员变量的对象图中所有的对象都开辟了内存空间；而浅拷贝只是传递地址指向，新的对象并没有对引用数据类型创建内存空间；<h3 id="实现方式-1"><a href="#实现方式-1" class="headerlink" title="实现方式"></a>实现方式</h3><h4 id="使用Cloneable-1"><a href="#使用Cloneable-1" class="headerlink" title="使用Cloneable"></a>使用Cloneable</h4>在上面使用<code>Cloneable</code>实现浅拷贝的基础上，对<code>clone</code>方法进行改造：<br><code>City.java</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xujian</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-12-26 12:30</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">City</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>, Serializable&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">City</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">City</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;City&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Address.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xujian</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-12-20 14:52</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>, Serializable&#123;</span><br><span class="line">    <span class="keyword">private</span> String addr;</span><br><span class="line">    <span class="keyword">private</span> City city;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Address</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Address</span><span class="params">(String addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddr</span><span class="params">(String addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCity</span><span class="params">(City city)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.city = city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> City <span class="title function_">getCity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> (Address) <span class="built_in">super</span>.clone();</span><br><span class="line">        <span class="type">City</span> <span class="variable">city</span> <span class="operator">=</span> (City) address.getCity().clone();</span><br><span class="line">        address.setCity(city);</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Address&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;addr=&#x27;&quot;</span> + addr + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, city=&quot;</span> + city +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>User.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xujian</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-12-20 14:52</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>, Serializable&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Address addr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> age, Address addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(User source)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = source.age;</span><br><span class="line">        <span class="built_in">this</span>.addr = source.addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Address <span class="title function_">getAddr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddr</span><span class="params">(Address addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) <span class="built_in">super</span>.clone();</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> (Address) user.getAddr().clone();</span><br><span class="line">        user.setAddr(address);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, addr=&quot;</span> + addr +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        source.setAge(<span class="number">70</span>);</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">        address.setAddr(<span class="string">&quot;陕西省&quot;</span>);</span><br><span class="line">        <span class="type">City</span> <span class="variable">city</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">City</span>(<span class="string">&quot;渭南市&quot;</span>);</span><br><span class="line">        address.setCity(city);</span><br><span class="line">        source.setAddr(address);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">copyUser</span> <span class="operator">=</span> (User) source.clone();</span><br><span class="line">        System.out.println(source);</span><br><span class="line">        System.out.println(copyUser);</span><br><span class="line">        System.out.println(source == copyUser);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">70</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;陕西省&#x27;</span>, city=<span class="title class_">City</span>&#123;name=<span class="string">&#x27;渭南市&#x27;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">70</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;陕西省&#x27;</span>, city=<span class="title class_">City</span>&#123;name=<span class="string">&#x27;渭南市&#x27;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这种方式在<code>clone()</code>方法的浅拷贝基础上，根据引用类型成员变量使用层层调用，来实现深拷贝，也是有点繁琐的。</p>
</blockquote>
<h4 id="序列化方式"><a href="#序列化方式" class="headerlink" title="序列化方式"></a>序列化方式</h4><blockquote>
<p>这种方式在我们日常开发工作中非常常见，避免了手动实现深拷贝中“递归”的操作，所以看上去会比上面的方式简单一点。</p>
</blockquote>
<h5 id="Json序列化-x2F-反序列化"><a href="#Json序列化-x2F-反序列化" class="headerlink" title="Json序列化&#x2F;反序列化"></a>Json序列化&#x2F;反序列化</h5><p>可以想一想，SpringMVC中的Controller在传递对象参数和返回对象数据时的序列化和反序列化。<br><img src="https://img-blog.csdnimg.cn/20201226161120388.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE4NTE1MTU1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p>从Json字符串反序列化来的对象都是一个新的对象。</p>
</blockquote>
<p>依旧是上面的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        source.setAge(<span class="number">70</span>);</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">        address.setAddr(<span class="string">&quot;陕西省&quot;</span>);</span><br><span class="line">        <span class="type">City</span> <span class="variable">city</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">City</span>(<span class="string">&quot;渭南市&quot;</span>);</span><br><span class="line">        address.setCity(city);</span><br><span class="line">        source.setAddr(address);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//序列化成json字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userJsonStr</span> <span class="operator">=</span> JSON.toJSONString(source);</span><br><span class="line">        <span class="comment">//反序列化成对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">copyUser</span> <span class="operator">=</span> JSON.parseObject(userJsonStr,User.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(source);</span><br><span class="line">        System.out.println(copyUser);</span><br><span class="line">        System.out.println(source == copyUser);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">70</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;陕西省&#x27;</span>, city=<span class="title class_">City</span>&#123;name=<span class="string">&#x27;渭南市&#x27;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">70</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;陕西省&#x27;</span>, city=<span class="title class_">City</span>&#123;name=<span class="string">&#x27;渭南市&#x27;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>可见反序列化生成的对象是一个新的对象。</p>
</blockquote>
<h5 id="JDK序列化-x2F-反序列化"><a href="#JDK序列化-x2F-反序列化" class="headerlink" title="JDK序列化&#x2F;反序列化"></a>JDK序列化&#x2F;反序列化</h5><p>同样还有JDK自带的序列化方式。<br>依旧是上面的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        source.setAge(<span class="number">70</span>);</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">        address.setAddr(<span class="string">&quot;陕西省&quot;</span>);</span><br><span class="line">        <span class="type">City</span> <span class="variable">city</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">City</span>(<span class="string">&quot;渭南市&quot;</span>);</span><br><span class="line">        address.setCity(city);</span><br><span class="line">        source.setAddr(address);</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">copyUser</span> <span class="operator">=</span> jdkDeepCopy(source);</span><br><span class="line"></span><br><span class="line">        System.out.println(source);</span><br><span class="line">        System.out.println(copyUser);</span><br><span class="line">        System.out.println(source == copyUser);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jdk序列化/反序列化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> User <span class="title function_">jdkDeepCopy</span><span class="params">(User source)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//将对象写到流里</span></span><br><span class="line">        ByteArrayOutputStream bo=<span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        ObjectOutputStream oo=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bo);</span><br><span class="line">        oo.writeObject(source);</span><br><span class="line">        <span class="comment">//从流里读出来</span></span><br><span class="line">        ByteArrayInputStream bi=<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bo.toByteArray());</span><br><span class="line">        ObjectInputStream oi=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bi);</span><br><span class="line">        <span class="keyword">return</span> (User) oi.readObject();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">70</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;陕西省&#x27;</span>, city=<span class="title class_">City</span>&#123;name=<span class="string">&#x27;渭南市&#x27;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">70</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;陕西省&#x27;</span>, city=<span class="title class_">City</span>&#123;name=<span class="string">&#x27;渭南市&#x27;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h4 id="手动使用Setter层层设置属性"><a href="#手动使用Setter层层设置属性" class="headerlink" title="手动使用Setter层层设置属性"></a>手动使用Setter层层设置属性</h4><p>还是基于上面的例子，增加一个手动使用Setter进行copy的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        source.setAge(<span class="number">70</span>);</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">        address.setAddr(<span class="string">&quot;陕西省&quot;</span>);</span><br><span class="line">        <span class="type">City</span> <span class="variable">city</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">City</span>(<span class="string">&quot;渭南市&quot;</span>);</span><br><span class="line">        address.setCity(city);</span><br><span class="line">        source.setAddr(address);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">copyUser</span> <span class="operator">=</span> getDeepCopyInstance(source);</span><br><span class="line">        System.out.println(source);</span><br><span class="line">        System.out.println(copyUser);</span><br><span class="line">        System.out.println(source == copyUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到指定对象的一个深拷贝对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> User <span class="title function_">getDeepCopyInstance</span><span class="params">(User source)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">copyUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        copyUser.setAge(source.getAge());</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>();</span><br><span class="line">        address.setAddr(source.getAddr().getAddr());</span><br><span class="line">        <span class="type">City</span> <span class="variable">city</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">City</span>();</span><br><span class="line">        city.setName(source.getAddr().getCity().getName());</span><br><span class="line">        address.setCity(city);</span><br><span class="line">        copyUser.setAddr(address);</span><br><span class="line">        <span class="keyword">return</span> copyUser;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">70</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;陕西省&#x27;</span>, city=<span class="title class_">City</span>&#123;name=<span class="string">&#x27;渭南市&#x27;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="title class_">User</span>&#123;age=<span class="number">70</span>, addr=<span class="title class_">Address</span>&#123;addr=<span class="string">&#x27;陕西省&#x27;</span>, city=<span class="title class_">City</span>&#123;name=<span class="string">&#x27;渭南市&#x27;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这个方法虽然可以达到效果，但是编码繁琐，并且不够通用，试想引用链很长的时候编码工作量得多恐怖。</p>
</blockquote>
<p>其他方式还可以借助<strong>反射直接进行属性赋值，内省机制（依赖于反射）通过调用Setter方法，构造函数</strong>等通过层层递归来进行对象的深拷贝。</p>
<h1 id="Bean拷贝工具"><a href="#Bean拷贝工具" class="headerlink" title="Bean拷贝工具"></a>Bean拷贝工具</h1><h2 id="Apache的BeanUtils"><a href="#Apache的BeanUtils" class="headerlink" title="Apache的BeanUtils"></a>Apache的BeanUtils</h2><p>位于<code>org.apache.commons.beanutils</code>包下。通过上面提到的<strong>内省机制</strong>调用<code>Setter</code>方法实现。默认实现<strong>浅拷贝</strong>，想要实现深拷贝，则需要提供自定义的<code>Converter</code>。<br>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanUtilsDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">UserDO</span> <span class="variable">userDO</span> <span class="operator">=</span> DataUtil.createData();</span><br><span class="line">        log.info(<span class="string">&quot;拷贝前,userDO:&#123;&#125;&quot;</span>, userDO);</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        BeanUtils.copyProperties(userDO,userDTO);</span><br><span class="line">        log.info(<span class="string">&quot;拷贝后,userDO:&#123;&#125;&quot;</span>, userDO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span>:<span class="number">12</span>:<span class="number">11.734</span> [main] <span class="variable constant_">INFO</span> cn.<span class="property">van</span>.<span class="property">parameter</span>.<span class="property">bean</span>.<span class="property">copy</span>.<span class="property">demo</span>.<span class="property">BeanUtilsDemo</span> - 拷贝前,<span class="attr">userDO</span>:<span class="title class_">UserDO</span>(id=<span class="number">1</span>, userName=<span class="title class_">Van</span>, gmtBroth=<span class="number">2019</span>-<span class="number">11</span>-02<span class="attr">T18</span>:<span class="number">12</span>:<span class="number">11.730</span>, balance=<span class="number">100</span>)</span><br><span class="line"><span class="number">18</span>:<span class="number">12</span>:<span class="number">11.917</span> [main] <span class="variable constant_">INFO</span> cn.<span class="property">van</span>.<span class="property">parameter</span>.<span class="property">bean</span>.<span class="property">copy</span>.<span class="property">demo</span>.<span class="property">BeanUtilsDemo</span> - 拷贝后,<span class="attr">userDO</span>:<span class="title class_">UserDO</span>(id=<span class="number">1</span>, userName=<span class="title class_">Van</span>, gmtBroth=<span class="number">2019</span>-<span class="number">11</span>-02<span class="attr">T18</span>:<span class="number">12</span>:<span class="number">11.730</span>, balance=<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>稳定性与效率都不行，不推荐使用。</p>
</blockquote>
<h2 id="Apache的PropertyUtils"><a href="#Apache的PropertyUtils" class="headerlink" title="Apache的PropertyUtils"></a>Apache的PropertyUtils</h2><p>位于<code>org.apache.commons.beanutils</code>包下。<br><code>PropertyUtils</code>的<code>copyProperties()</code>方法几乎与<code>BeanUtils.copyProperties()</code>相同，主要的区别在于<code>BeanUtils.copyProperties()</code>提供<strong>类型转换</strong>功能，即发现两个JavaBean的同名属性为不同类型时，在支持的数据类型范围内进行转换，PropertyUtils不支持这个功能，所以说BeanUtils使用更普遍一点，犯错的风险更低一点，默认实现<strong>浅拷贝</strong>。</p>
<h2 id="Apache的SerializationUtils"><a href="#Apache的SerializationUtils" class="headerlink" title="Apache的SerializationUtils"></a>Apache的SerializationUtils</h2><p>位于<code>org.apache.commons.lang3</code>包下。<br><code>SerializationUtils.clone(T)</code>，T对象需要实现 Serializable 接口，基于JDK序列化实现了<strong>深克隆</strong>。</p>
<blockquote>
<p>深拷贝可以使用。</p>
</blockquote>
<h2 id="Spring的BeanUtils"><a href="#Spring的BeanUtils" class="headerlink" title="Spring的BeanUtils"></a>Spring的BeanUtils</h2><p>位于<code>org.springframework.beans</code>包下。<br>其<code>copyProperties</code>方法实现原理和<code>Apache BeanUtils.copyProperties</code>原理类似，默认实现<strong>浅拷贝</strong>，区别在于对<code>PropertyDescriptor</code>（内省机制相关）的处理结果做了缓存来提升性能。</p>
<h2 id="Spring的BeanCopier"><a href="#Spring的BeanCopier" class="headerlink" title="Spring的BeanCopier"></a>Spring的BeanCopier</h2><p>位于<code>org.springframework.cglib.beans</code>包下，默认实现<strong>浅拷贝</strong>。<br>BeanCopier支持两种方式:</p>
<ol>
<li>不使用Converter的方式，仅对两个bean间属性名和类型完全相同的变量进行拷贝;</li>
<li>引入Converter，可以对某些特定属性值进行特殊操作，但性能会大大降低。</li>
</ol>
<p>通过操作字节码生成类，来实现原本需要通过反射或者一堆代码才能实现的逻辑，内部还是通过直接调用<code>Setter</code>方法来实现。</p>
<blockquote>
<p>使用了字节码操作取代反射，使用缓存以及通过<code>Setter</code>方法设置属性值使其性能非常优秀，推荐使用。</p>
</blockquote>
<p><strong>Tips</strong>：<br><em>实际使用时，可以把创建过的BeanCopier实例放到缓存中，下次可以直接获取，提升性能。</em></p>
<h2 id="MapStruct"><a href="#MapStruct" class="headerlink" title="MapStruct"></a>MapStruct</h2><p>默认实现<strong>浅拷贝</strong>，通过注解编译时自动生成拷贝的代码，基于直接调用<code>Setter</code>方法实现。</p>
<blockquote>
<p>性能还不错，主要是使用方便，加上注解就可以用了。</p>
</blockquote>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li>浅拷贝：是对原对象的属性值进行精准复制，那么对如果原对象的属性值是基本类型那就是值的引用，所以浅拷贝后修改基本类型不会修改到原对象的，如果原对象属性值是引用类型，那么就是对引用类型属性值的栈内存的复制，所以修改引用类型属性值的时候回修改到原对象。</li>
<li>深拷贝：在浅拷贝的基础上，对引用类型开辟新的堆内存进行层层拷贝。</li>
<li>上文中提到的深堆，浅堆，内省机制有兴趣的可以自行了解。</li>
</ol>
<p>上文示例代码请参考：<a target="_blank" rel="noopener" href="https://github.com/xujian01/blogcode/tree/master/src/main/java/shallowcopy">浅拷贝</a>、<a target="_blank" rel="noopener" href="https://github.com/xujian01/blogcode/tree/master/src/main/java/deepcopy">深拷贝</a>。</p>
<h1 id="观众老爷求点赞"><a href="#观众老爷求点赞" class="headerlink" title="观众老爷求点赞"></a>观众老爷求点赞</h1></div><div class="tags"><a href="/tags/Java/"><i class="fa fa-tag"></i>Java</a></div><div class="post-nav"><a class="pre" href="/2020/09/05/service-mesh/">Service Mesh和服务Mesh化的认知和理解</a><a class="next" href="/2020/06/22/apollo-auto-refresh/">基于Apollo的配置自动刷新组件</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Apollo/" style="font-size: 15px;">Apollo</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Canal/" style="font-size: 15px;">Canal</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Mybatis/" style="font-size: 15px;">Mybatis</a> <a href="/tags/RocketMQ/" style="font-size: 15px;">RocketMQ</a> <a href="/tags/Gson/" style="font-size: 15px;">Gson</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 15px;">多线程</a> <a href="/tags/GitLab/" style="font-size: 15px;">GitLab</a> <a href="/tags/WebHook/" style="font-size: 15px;">WebHook</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/Swagger/" style="font-size: 15px;">Swagger</a> <a href="/tags/ServiceMesh/" style="font-size: 15px;">ServiceMesh</a> <a href="/tags/Skywalking/" style="font-size: 15px;">Skywalking</a> <a href="/tags/ES/" style="font-size: 15px;">ES</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/06/25/print-xyz/">使用三个线程，按顺序打印X，Y，Z，连续打印10次</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/19/enhance-jdk-proxy-v2/">实现一个增强版的JDK动态代理V2.0</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/15/enhance-jdk-proxy-v1/">实现一个增强版的JDK动态代理V1.0</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/13/mybatis-plugin/">这么强大的Mybatis插件机制原来就是这？</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/10/spring-circle-depence/">探索Spring循环依赖的细节</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/12/skywalking-plugin-principle/">Skywalking如何通过修改字节码让插件生效</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/26/gson-serialize-fail/">Gson序列化LinkedHashMap.Entry失败的探索</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/20/springboot-es-mongodb/">SpringBoot中使用ES和MongoDB常用API</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/20/java-complier-optimization/">又长见识了！JVM编译优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/15/swagger+yapi/">Swagger API Spec + Swagger Codegen + YAPI管理接口文档</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.csdn.net/qq_18515155" title="CSDN-徐小陌的博客" target="_blank">CSDN-徐小陌的博客</a><ul></ul><a href="https://www.zhihu.com/people/xu-jian-1-1" title="知乎-倔强的码农" target="_blank">知乎-倔强的码农</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">墨鱼🦑的个人博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>